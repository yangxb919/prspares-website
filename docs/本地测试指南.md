# 本地测试指南

## 📋 为什么需要本地测试？

之前遇到的所有错误（缺少依赖、TypeScript 类型错误、ESLint 配置错误等）**在本地和 VPS 都会出现**。

通过在本地先测试，可以：
- ✅ 避免反复 push 和 pull
- ✅ 节省 VPS 部署时间
- ✅ 更快发现和修复问题
- ✅ 保持 Git 历史干净

---

## 🚀 方法 1：手动测试（推荐）

在每次 push 之前运行：

```bash
# 运行测试脚本
./scripts/test-before-push.sh
```

这个脚本会依次运行：
1. **TypeScript 类型检查** - 检查类型错误
2. **ESLint 代码检查** - 检查代码规范
3. **构建测试** - 完整构建项目

如果所有测试都通过，就可以安全 push 了！

---

## 🔧 方法 2：分步测试

如果你想单独运行某个测试：

```bash
# 1. 类型检查
npm run type-check

# 2. ESLint 检查
npm run lint

# 3. 构建测试
npm run build:fast

# 4. 完整构建（包含图片优化）
npm run build
```

---

## 📝 完整工作流程

```bash
# 1. 修改代码
# ... 编辑文件 ...

# 2. 本地测试
./scripts/test-before-push.sh

# 3. 如果测试通过，提交代码
git add -A
git commit -m "你的提交信息"

# 4. Push 到 GitHub
git push origin master

# 5. 在 VPS 上部署
ssh root@your_vps_ip
cd /var/www/prspares-website
git pull origin master
npm install  # 如果有新依赖
npm run build:fast
pm2 restart prspares
```

---

## ⚡ 快速命令

```bash
# 测试 + 提交 + Push（一行命令）
./scripts/test-before-push.sh && git add -A && git commit -m "你的提交信息" && git push origin master
```

---

## 🎯 常见问题

### Q: 为什么本地 `npm run dev` 正常，但构建失败？

A: 因为开发模式（`npm run dev`）不会进行完整的类型检查和 ESLint 检查。只有 `npm run build` 才会。

### Q: 如何跳过测试直接 push？

A: 可以，但不推荐。如果确实需要：
```bash
git push origin master --no-verify
```

### Q: 测试脚本在哪里？

A: 在 `scripts/test-before-push.sh`

### Q: 如何启用自动 Git hooks？

A: 编辑 `.husky/pre-push` 文件，取消注释检查命令。

---

## 📊 性能对比

| 方式 | 时间 | 优点 | 缺点 |
|------|------|------|------|
| **本地测试后 push** | 本地 2-3 分钟 + VPS 4-6 分钟 | 一次成功，节省时间 | 需要手动运行 |
| **直接 push 到 VPS** | VPS 15-20 分钟（可能失败多次） | 简单 | 浪费时间，反复调试 |

---

## ✅ 最佳实践

1. **每次修改代码后**，先运行 `./scripts/test-before-push.sh`
2. **只有测试通过后**，才 push 到 GitHub
3. **定期运行** `npm run build` 确保完整构建正常
4. **添加新依赖后**，记得在 VPS 上运行 `npm install`

---

## 🔗 相关文件

- `scripts/test-before-push.sh` - 测试脚本
- `.husky/pre-push` - Git pre-push hook（默认禁用）
- `package.json` - 包含所有测试命令
- `.eslintrc.json` - ESLint 配置

---

## 📞 需要帮助？

如果遇到问题，检查：
1. 是否运行了 `npm install`
2. 是否有 `.env.local` 文件
3. Node.js 版本是否正确（建议 18.x 或更高）

