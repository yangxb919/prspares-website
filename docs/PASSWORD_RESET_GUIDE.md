# å¯†ç é‡ç½®åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

ç½‘ç«™ç°åœ¨åŒ…å«å®Œæ•´çš„å¯†ç é‡ç½®åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡é‚®ä»¶é“¾æ¥é‡ç½®å¯†ç ã€‚

---

## ğŸ”— ç›¸å…³é¡µé¢

### App Router ç‰ˆæœ¬ï¼ˆæ¨èï¼‰

1. **å¿˜è®°å¯†ç é¡µé¢**: `/forgot-password`
   - æ–‡ä»¶: `src/app/forgot-password/page.tsx`
   - åŠŸèƒ½: ç”¨æˆ·è¾“å…¥é‚®ç®±ï¼Œç³»ç»Ÿå‘é€é‡ç½®é“¾æ¥

2. **é‡ç½®å¯†ç é¡µé¢**: `/reset-password`
   - æ–‡ä»¶: `src/app/reset-password/page.tsx`
   - åŠŸèƒ½: ç”¨æˆ·é€šè¿‡é‚®ä»¶é“¾æ¥è®¿é—®ï¼Œè¾“å…¥æ–°å¯†ç 

3. **ç™»å½•é¡µé¢**: `/login`
   - æ–‡ä»¶: `src/app/login/page.tsx`
   - å·²æ·»åŠ "å¿˜è®°å¯†ç "é“¾æ¥

### Pages Router ç‰ˆæœ¬

1. **å¿˜è®°å¯†ç é¡µé¢**: `/auth/forgot-password`
   - æ–‡ä»¶: `src/pages/auth/forgot-password.tsx`
   - åŠŸèƒ½: ç”¨æˆ·è¾“å…¥é‚®ç®±ï¼Œç³»ç»Ÿå‘é€é‡ç½®é“¾æ¥

2. **é‡ç½®å¯†ç é¡µé¢**: `/auth/reset-password`
   - æ–‡ä»¶: `src/pages/auth/reset-password.tsx`
   - åŠŸèƒ½: ç”¨æˆ·é€šè¿‡é‚®ä»¶é“¾æ¥è®¿é—®ï¼Œè¾“å…¥æ–°å¯†ç 

3. **ç™»å½•é¡µé¢**: `/auth/signin`
   - æ–‡ä»¶: `src/pages/auth/signin.tsx`
   - å·²æ·»åŠ "å¿˜è®°å¯†ç "é“¾æ¥

---

## ğŸ”„ å®Œæ•´æµç¨‹

### ç”¨æˆ·ç«¯æµç¨‹

1. **è¯·æ±‚é‡ç½®å¯†ç **
   ```
   ç”¨æˆ·è®¿é—®ç™»å½•é¡µé¢ â†’ ç‚¹å‡»"Forgot password?" 
   â†’ è¿›å…¥å¿˜è®°å¯†ç é¡µé¢ â†’ è¾“å…¥é‚®ç®± â†’ ç‚¹å‡»"Send Reset Link"
   ```

2. **æ¥æ”¶é‚®ä»¶**
   ```
   ç”¨æˆ·æ”¶åˆ° Supabase å‘é€çš„å¯†ç é‡ç½®é‚®ä»¶
   â†’ é‚®ä»¶åŒ…å«é‡ç½®é“¾æ¥ï¼ˆæœ‰æ•ˆæœŸ 1 å°æ—¶ï¼‰
   ```

3. **é‡ç½®å¯†ç **
   ```
   ç”¨æˆ·ç‚¹å‡»é‚®ä»¶ä¸­çš„é“¾æ¥ â†’ è·³è½¬åˆ°é‡ç½®å¯†ç é¡µé¢
   â†’ è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘ 6 ä¸ªå­—ç¬¦ï¼‰â†’ ç¡®è®¤æ–°å¯†ç 
   â†’ ç‚¹å‡»"Reset Password" â†’ å¯†ç æ›´æ–°æˆåŠŸ
   â†’ è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼ˆ3 ç§’åï¼‰
   ```

4. **ä½¿ç”¨æ–°å¯†ç ç™»å½•**
   ```
   ç”¨æˆ·ä½¿ç”¨æ–°å¯†ç ç™»å½• â†’ æˆåŠŸè¿›å…¥ç³»ç»Ÿ
   ```

---

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### 1. å‘é€é‡ç½®é‚®ä»¶

```typescript
const { error } = await supabase.auth.resetPasswordForEmail(email, {
  redirectTo: `${origin}/reset-password`,
});
```

### 2. éªŒè¯é‡ç½®é“¾æ¥

```typescript
// URL å‚æ•°ç¤ºä¾‹: /reset-password?type=recovery&token=xxx
const { type, token } = searchParams;

if (type === 'recovery' && token) {
  // é“¾æ¥æœ‰æ•ˆ
  setValidToken(true);
} else {
  // é“¾æ¥æ— æ•ˆæˆ–è¿‡æœŸ
  setError('Invalid or expired password reset link');
}
```

### 3. æ›´æ–°å¯†ç 

```typescript
const { data, error } = await supabase.auth.updateUser({
  password: newPassword,
});
```

---

## âš™ï¸ Supabase é…ç½®

### é‚®ä»¶æ¨¡æ¿é…ç½®

1. ç™»å½• Supabase Dashboard
2. è¿›å…¥ **Authentication** â†’ **Email Templates**
3. æ‰¾åˆ° **Reset Password** æ¨¡æ¿
4. ç¡®è®¤é‡å®šå‘ URL è®¾ç½®æ­£ç¡®ï¼š
   ```
   {{ .SiteURL }}/reset-password?type=recovery&token={{ .Token }}
   ```

### SMTP é…ç½®ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦è‡ªå®šä¹‰é‚®ä»¶å‘é€ï¼š

1. è¿›å…¥ **Project Settings** â†’ **Auth**
2. é…ç½® **SMTP Settings**
3. è®¾ç½®å‘ä»¶äººé‚®ç®±å’Œ SMTP æœåŠ¡å™¨

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æµ‹è¯• App Router ç‰ˆæœ¬

1. **è®¿é—®ç™»å½•é¡µé¢**
   ```
   http://localhost:3003/login
   ```

2. **ç‚¹å‡»"Forgot password?"é“¾æ¥**
   ```
   åº”è¯¥è·³è½¬åˆ°: http://localhost:3003/forgot-password
   ```

3. **è¾“å…¥æµ‹è¯•é‚®ç®±å¹¶æäº¤**
   ```
   ä¾‹å¦‚: yangbowen919@gmail.com
   ```

4. **æ£€æŸ¥é‚®ç®±**
   ```
   æŸ¥çœ‹æ˜¯å¦æ”¶åˆ° Supabase å‘é€çš„é‡ç½®é‚®ä»¶
   ```

5. **ç‚¹å‡»é‚®ä»¶ä¸­çš„é“¾æ¥**
   ```
   åº”è¯¥è·³è½¬åˆ°: http://localhost:3003/reset-password?type=recovery&token=xxx
   ```

6. **è¾“å…¥æ–°å¯†ç **
   ```
   æ–°å¯†ç : è‡³å°‘ 6 ä¸ªå­—ç¬¦
   ç¡®è®¤å¯†ç : å¿…é¡»ä¸æ–°å¯†ç ä¸€è‡´
   ```

7. **æäº¤å¹¶éªŒè¯**
   ```
   åº”è¯¥æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
   3 ç§’åè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢
   ```

8. **ä½¿ç”¨æ–°å¯†ç ç™»å½•**
   ```
   éªŒè¯æ–°å¯†ç æ˜¯å¦ç”Ÿæ•ˆ
   ```

### æµ‹è¯• Pages Router ç‰ˆæœ¬

ä½¿ç”¨ç›¸åŒçš„æ­¥éª¤ï¼Œä½†è®¿é—®ä»¥ä¸‹ URLï¼š
- ç™»å½•: `http://localhost:3003/auth/signin`
- å¿˜è®°å¯†ç : `http://localhost:3003/auth/forgot-password`
- é‡ç½®å¯†ç : `http://localhost:3003/auth/reset-password`

---

## ğŸ”’ å®‰å…¨ç‰¹æ€§

1. **é“¾æ¥æœ‰æ•ˆæœŸ**: é‡ç½®é“¾æ¥ 1 å°æ—¶åè‡ªåŠ¨å¤±æ•ˆ
2. **ä¸€æ¬¡æ€§ä½¿ç”¨**: æ¯ä¸ªé‡ç½®é“¾æ¥åªèƒ½ä½¿ç”¨ä¸€æ¬¡
3. **å¯†ç å¼ºåº¦**: è¦æ±‚è‡³å°‘ 6 ä¸ªå­—ç¬¦
4. **å¯†ç ç¡®è®¤**: å¿…é¡»è¾“å…¥ä¸¤æ¬¡ç›¸åŒçš„å¯†ç 
5. **Token éªŒè¯**: æœåŠ¡å™¨ç«¯éªŒè¯ token çš„æœ‰æ•ˆæ€§

---

## âŒ é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

1. **"Invalid or expired password reset link"**
   - åŸå› : é“¾æ¥å·²è¿‡æœŸæˆ–å·²ä½¿ç”¨
   - è§£å†³: é‡æ–°è¯·æ±‚é‡ç½®é“¾æ¥

2. **"Passwords do not match"**
   - åŸå› : ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´
   - è§£å†³: ç¡®ä¿ä¸¤æ¬¡è¾“å…¥ç›¸åŒçš„å¯†ç 

3. **"Password must be at least 6 characters long"**
   - åŸå› : å¯†ç å¤ªçŸ­
   - è§£å†³: ä½¿ç”¨è‡³å°‘ 6 ä¸ªå­—ç¬¦çš„å¯†ç 

4. **"Failed to send reset email"**
   - åŸå› : é‚®ç®±ä¸å­˜åœ¨æˆ– SMTP é…ç½®é”™è¯¯
   - è§£å†³: æ£€æŸ¥é‚®ç®±æ˜¯å¦æ­£ç¡®ï¼Œæˆ–è”ç³»ç®¡ç†å‘˜

---

## ğŸ“ è¿ç§»åçš„ç”¨æˆ·

å¯¹äºä»æ—§æ•°æ®åº“è¿ç§»è¿‡æ¥çš„ 4 ä¸ªç”¨æˆ·ï¼š
- yangbowen919@gmail.com
- 601817635@qq.com
- lijiedong08@gmail.com
- yangxb919@gmail.com

ä»–ä»¬éœ€è¦ä½¿ç”¨å¯†ç é‡ç½®åŠŸèƒ½æ¥è®¾ç½®æ–°å¯†ç ï¼Œå› ä¸ºæ—§å¯†ç æ— æ³•è¿ç§»ã€‚

### é€šçŸ¥ç”¨æˆ·çš„å»ºè®®æ¶ˆæ¯

```
å°Šæ•¬çš„ç”¨æˆ·ï¼Œ

æˆ‘ä»¬å·²å®Œæˆæ•°æ®åº“è¿ç§»ã€‚ç”±äºå®‰å…¨åŸå› ï¼Œæ‚¨éœ€è¦é‡ç½®å¯†ç æ‰èƒ½ç»§ç»­ä½¿ç”¨è´¦å·ã€‚

è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š
1. è®¿é—®ç™»å½•é¡µé¢
2. ç‚¹å‡»"Forgot password?"
3. è¾“å…¥æ‚¨çš„é‚®ç®±åœ°å€
4. æŸ¥æ”¶é‡ç½®é‚®ä»¶å¹¶ç‚¹å‡»é“¾æ¥
5. è®¾ç½®æ–°å¯†ç 

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·è”ç³»æˆ‘ä»¬ã€‚

è°¢è°¢ï¼
```

---

## ğŸ¨ UI/UX ç‰¹æ€§

1. **å“åº”å¼è®¾è®¡**: é€‚é…æ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡
2. **åŠ è½½çŠ¶æ€**: æ˜¾ç¤º"Sending..."ã€"Resetting Password..."ç­‰çŠ¶æ€
3. **æˆåŠŸæç¤º**: ç»¿è‰²å‹¾é€‰å›¾æ ‡ + æˆåŠŸæ¶ˆæ¯
4. **é”™è¯¯æç¤º**: çº¢è‰²è¾¹æ¡† + é”™è¯¯æ¶ˆæ¯
5. **è‡ªåŠ¨è·³è½¬**: æˆåŠŸå 3 ç§’è‡ªåŠ¨è·³è½¬
6. **é‡å‘åŠŸèƒ½**: å¯ä»¥é‡æ–°å‘é€é‡ç½®é‚®ä»¶

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [Supabase Auth Documentation](https://supabase.com/docs/guides/auth)
- [Password Reset Flow](https://supabase.com/docs/guides/auth/auth-password-reset)
- [Email Templates](https://supabase.com/docs/guides/auth/auth-email-templates)

---

## âœ… å®Œæˆæ¸…å•

- [x] åˆ›å»ºå¿˜è®°å¯†ç é¡µé¢ï¼ˆApp Routerï¼‰
- [x] åˆ›å»ºé‡ç½®å¯†ç é¡µé¢ï¼ˆApp Routerï¼‰
- [x] åˆ›å»ºå¿˜è®°å¯†ç é¡µé¢ï¼ˆPages Routerï¼‰
- [x] æ›´æ–°é‡ç½®å¯†ç é¡µé¢ï¼ˆPages Routerï¼‰
- [x] åœ¨ç™»å½•é¡µé¢æ·»åŠ "å¿˜è®°å¯†ç "é“¾æ¥
- [x] å®ç°å¯†ç éªŒè¯é€»è¾‘
- [x] å®ç°é”™è¯¯å¤„ç†
- [x] å®ç°æˆåŠŸæç¤ºå’Œè‡ªåŠ¨è·³è½¬
- [x] ç¼–å†™ä½¿ç”¨æ–‡æ¡£

---

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿæˆ–æŸ¥çœ‹ Supabase æ–‡æ¡£ã€‚

